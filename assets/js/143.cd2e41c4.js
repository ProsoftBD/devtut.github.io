(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{489:function(a,s,t){"use strict";t.r(s);var n=t(19),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"creating-overlay-always-on-top-windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creating-overlay-always-on-top-windows"}},[a._v("#")]),a._v(" Creating Overlay (always-on-top) Windows")]),a._v(" "),t("h2",{attrs:{id:"popup-overlay"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#popup-overlay"}},[a._v("#")]),a._v(" Popup overlay")]),a._v(" "),t("p",[a._v("In order to put your view on top of every application, you have to assign your view to the corresponding window manager. For that you need the system alert permission, which can be requested by adding the following line to your manifest file:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("uses")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("permission android"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"android.permission.SYSTEM_ALERT_WINDOW"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n")])])]),t("p",[t("strong",[a._v("Note:")]),a._v(" If your application gets destroyed, your view will be removed from the window manager. Therefore, it is better to create the view and assign it to the window manager by a foreground service.")]),a._v(" "),t("h3",{attrs:{id:"assigning-a-view-to-the-windowmanager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#assigning-a-view-to-the-windowmanager"}},[a._v("#")]),a._v(" Assigning a view to the WindowManager")]),a._v(" "),t("p",[a._v("You can retrieve a window manager instance as follows:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),a._v(" mWindowManager "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" mContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getSystemService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("WINDOW_SERVICE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])])]),t("p",[a._v("In order to define the position of your view, you have to create some layout parameters as follows:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LayoutParams")]),a._v(" mLayoutParams "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LayoutParams")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ViewGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LayoutParams")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("MATCH_PARENT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ViewGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LayoutParams")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("MATCH_PARENT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LayoutParams")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("TYPE_PHONE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LayoutParams")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("FLAG_TURN_SCREEN_ON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PixelFormat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("TRANSLUCENT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nmLayoutParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gravity "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Gravity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("CENTER_HORIZONTAL "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Gravity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("CENTER_VERTICAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])])]),t("p",[a._v("Now, you can assign your view together with the created layout parameters to the window manager instance as follows:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("mWindowManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addView")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("yourView"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mLayoutParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])])]),t("p",[a._v("Voila! Your view has been successfully placed on top of all other applications.")]),a._v(" "),t("p",[t("strong",[a._v("Note:")]),a._v(" You view will not be put on top of the keyguard.")]),a._v(" "),t("h2",{attrs:{id:"granting-system-alert-window-permission-on-android-6-0-and-above"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#granting-system-alert-window-permission-on-android-6-0-and-above"}},[a._v("#")]),a._v(" Granting SYSTEM_ALERT_WINDOW Permission on android 6.0 and above")]),a._v(" "),t("p",[a._v("From android 6.0 this permission needs to grant dynamically,")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("uses")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("permission android"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"android.permission.SYSTEM_ALERT_WINDOW"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n")])])]),t("p",[a._v("Throwing below permission denied error on 6.0,")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Caused")]),a._v(" by"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" android"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManager")]),a._v("$"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BadTokenException")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Unable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" add window android"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ViewRootImpl")]),a._v("$"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("W")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@86fb55b")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" permission denied "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),a._v(" window type\n\n")])])]),t("p",[a._v("Solution :-")]),a._v(" "),t("p",[a._v("Requesting Overlay permission as below,")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Settings")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("canDrawOverlays")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ask for setting ")]),a._v("\n     "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Intent")]),a._v(" intent "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Intent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Settings")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("ACTION_MANAGE_OVERLAY_PERMISSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n     "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("parse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"package:"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getPackageName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n     "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("startActivityForResult")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("intent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" REQUEST_OVERLAY_PERMISSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("Check for the result,")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onActivityResult")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" requestCode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" resultCode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Intent")]),a._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("requestCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" REQUEST_OVERLAY_PERMISSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Settings")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("canDrawOverlays")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// permission granted...")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// permission not granted...")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);