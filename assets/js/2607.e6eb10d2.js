(window.webpackJsonp=window.webpackJsonp||[]).push([[2607],{2953:function(a,s,t){"use strict";t.r(s);var e=t(19),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"powershell-background-jobs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powershell-background-jobs"}},[a._v("#")]),a._v(" PowerShell Background Jobs")]),a._v(" "),t("p",[a._v("Jobs were introduced in PowerShell 2.0 and helped to solve a problem inherent in the command-line tools. In a nutshell, if you start a long running task, your prompt is unavailable until the task finishes. As an example of a long running task, think of this simple PowerShell command:")]),a._v(" "),t("p",[t("strong",[a._v("Get-ChildItem -Path c:\\ -Recurse")])]),a._v(" "),t("p",[a._v("It will take a while to fetch full directory list of your C: drive.\nIf you run it as Job then the console will get the control back and you can capture the result later on.")]),a._v(" "),t("h2",{attrs:{id:"basic-job-creation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic-job-creation"}},[a._v("#")]),a._v(" Basic job creation")]),a._v(" "),t("p",[a._v("Start a Script Block as background job:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Start-Job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("Start a script as background job:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Start-Job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("FilePath "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"C:\\YourFolder\\Script.ps1"')]),a._v("\n\n")])])]),t("p",[a._v("Start a job using "),t("code",[a._v("Invoke-Command")]),a._v(" on a remote machine:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Invoke-Command")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ComputerName "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ComputerName"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Get-Service")]),a._v(" winrm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("JobName "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"WinRM"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ThrottleLimit 16 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("AsJob\n\n")])])]),t("p",[a._v("Start job as a different user (Prompts for password):")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Start-Job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Credential "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Domain\\Username"')]),a._v("\n\n")])])]),t("p",[a._v("Or")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Start-Job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Credential "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Get"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Credential"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])])]),t("p",[a._v("Start job as a different user (No prompt):")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$username")]),a._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Domain\\Username"')]),a._v(" \n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$password")]),a._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"password"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$secPassword")]),a._v(" = ConvertTo"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("SecureString "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("String "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$password")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("AsPlainText "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Force\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$credentials")]),a._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("New-Object")]),a._v(" System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Automation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("PSCredential "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ArgumentList @"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$secPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Start-Job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Credential "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$credentials")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"basic-job-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic-job-management"}},[a._v("#")]),a._v(" Basic job management")]),a._v(" "),t("p",[a._v("Get a list of all jobs in the current session:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Get-Job")]),a._v("\n\n")])])]),t("p",[a._v("Waiting on a job to finish before getting the result:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Wait-job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Receive-Job")]),a._v(" \n\n")])])]),t("p",[a._v("Timeout a job if it runs too long (10 seconds in this example)")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Wait-job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Timeout 10\n\n")])])]),t("p",[a._v("Stopping a job (completes all tasks that are pending in that job queue before ending):")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Stop-Job")]),a._v(" \n\n")])])]),t("p",[a._v("Remove job from current session's background jobs list:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Remove-Job")]),a._v("\n\n")])])]),t("p",[t("strong",[a._v("Note")]),a._v(": The following will only work on "),t("code",[a._v("Workflow")]),a._v(" Jobs.")]),a._v(" "),t("p",[a._v("Suspend a "),t("code",[a._v("Workflow")]),a._v(" Job (Pause):")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Suspend-Job")]),a._v(" \n\n")])])]),t("p",[a._v("Resume a "),t("code",[a._v("Workflow")]),a._v(" Job:")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Resume-Job")]),a._v(" \n\n")])])]),t("h4",{attrs:{id:"remarks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[a._v("#")]),a._v(" Remarks")]),a._v(" "),t("p",[a._v("PowerShell Jobs run in a new process.  This has pros and cons which are related.")]),a._v(" "),t("p",[a._v("Pros:")]),a._v(" "),t("ol",[t("li",[a._v("The job runs in a clean process, including environment.")]),a._v(" "),t("li",[a._v("The job can run asynchronously to your main PowerShell process")])]),a._v(" "),t("p",[a._v("Cons:")]),a._v(" "),t("ol",[t("li",[a._v("Process environment changes will not be present in the job.\n")]),t("li",[a._v("Parameters pass to and returned results are serialized.\n"),t("ul")]),a._v(" "),t("li",[a._v("This means if you change a parameter object while the job is running it will not be reflected in the job.")]),a._v(" "),t("li",[a._v("This also means if an object cannot be serialized you cannot pass or return it (although PowerShell may Copy any parameters and pass/return a PSObject.)\n")])])])}),[],!1,null,null,null);s.default=r.exports}}]);